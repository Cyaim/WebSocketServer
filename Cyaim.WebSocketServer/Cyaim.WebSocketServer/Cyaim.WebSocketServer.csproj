<?xml version="1.0" encoding="utf-8"?>
<Project Sdk="Microsoft.NET.Sdk">
    <PropertyGroup>
        <TargetFrameworks>netstandard2.1;net6.0;net7.0;net8.0;net9.0;net10.0</TargetFrameworks>
    </PropertyGroup>
    <PropertyGroup>
        <GeneratePackageOnBuild>true</GeneratePackageOnBuild>
        <PackageRequireLicenseAcceptance>true</PackageRequireLicenseAcceptance>
        <Authors>Psyche</Authors>
        <Company>Cyaim Studio</Company>
        <PackageProjectUrl>https://github.com/Cyaim/WebSocketServer</PackageProjectUrl>
        <PackageLicenseFile>LICENSE</PackageLicenseFile>
        <RepositoryUrl>https://github.com/Cyaim/WebSocketServer</RepositoryUrl>
        <Copyright>Copyright Â© Cyaim Studio</Copyright>
        <Version>2.0.0</Version>
        <PackageReleaseNotes>
            ## Version 2.0.0 - Major Release
            
            ### ğŸ‰ New Features
            
            - **Request ID Validation**: Added `RequireRequestId` configuration option (default: true) to reject requests without Id property, ensuring clients can distinguish response sources
            - **Bandwidth Limiting**: Comprehensive bandwidth rate limiting system with channel-level and endpoint-level policies
            - **Cluster Support**: Full cluster functionality with Raft protocol, automatic routing, and fault tolerance
            - **Dashboard**: Complete monitoring dashboard with real-time statistics, bandwidth monitoring, and cluster management
            - **Source Generator**: Performance-optimized source generator for endpoint injection and method invocation
            - **OpenTelemetry Integration**: Standard metrics export support for observability
            - **Access Control**: IP-based access control with configurable policies
            
            ### âš¡ Performance Improvements
            
            - Optimized endpoint injection using source generators (fallback to reflection)
            - Optimized method invocation using source generators (fallback to reflection)
            - Improved connection management and resource cleanup
            - Enhanced pipeline processing performance
            
            ### ğŸ”§ Enhancements
            
            - Enhanced error handling and logging
            - Improved cluster connection registration and unregistration
            - Better support for .NET 9.0 and .NET 10.0
            - Enhanced metrics collection and statistics recording
            
            ### ğŸ“¦ Cluster Extensions
            
            - **StackExchange.Redis**: Redis cluster transport using StackExchange.Redis
            - **FreeRedis**: Redis cluster transport using FreeRedis
            - **RabbitMQ**: RabbitMQ cluster transport
            - **Hybrid**: Hybrid cluster transport with Redis for service discovery and RabbitMQ for message routing
            
            ### ğŸ› Bug Fixes
            
            - Fixed Task return type handling for endpoint methods
            - Fixed source generator injector type lookup logic
            - Improved exception handling and error messages
            - Fixed connection cleanup in cluster scenarios
            
            ### ğŸ“š Documentation
            
            - Updated documentation with new features
            - Added bandwidth limiting configuration guide
            - Enhanced cluster setup documentation
            - Improved API reference documentation
        </PackageReleaseNotes>
        <PackageIcon>WebSocketRepository_Logo.png</PackageIcon>
        <Description>WebSocketServer is lightweight and high performance WebSocket server library. Support route, full duplex communication, multiplexing, pipeline, encryption. WebSocketServer æ˜¯ä¸€ä¸ªè½»é‡çº§ã€é«˜æ€§èƒ½WebSocketæœåŠ¡ç«¯åº“ã€‚æ”¯æŒ WebApi è·¯ç”±ã€å…¨åŒå·¥é€šä¿¡ã€å¤šè·¯å¤ç”¨ã€ç®¡é“ã€åŠ å¯†ç­‰ã€‚</Description>
        <PackageReadmeFile>README.md</PackageReadmeFile>
    </PropertyGroup>
    <ItemGroup Condition="'$(TargetFramework)' == 'net6.0' Or '$(TargetFramework)' == 'net7.0' Or '$(TargetFramework)' == 'net8.0' Or '$(TargetFramework)' == 'net9.0' Or '$(TargetFramework)' == 'net10.0'">
        <FrameworkReference Include="Microsoft.AspNetCore.App" />
    </ItemGroup>
    <!-- å¯¹äº .NET Standard 2.1 ç‰ˆæœ¬ -->
    <ItemGroup Condition="'$(TargetFramework)' == 'netstandard2.0'">
        <!-- <PackageReference Include="System.Text.Encodings.Web" Version="8.0.0" /> -->
        <PackageReference Include="Microsoft.AspNetCore.Http.Abstractions" Version="2.1.1" />
        <PackageReference Include="Microsoft.CSharp" Version="4.7.0" />
        <PackageReference Include="Microsoft.Extensions.Logging.Abstractions" Version="8.0.1" />
        <PackageReference Include="Microsoft.Extensions.DependencyInjection" Version="8.0.0" />
        <PackageReference Include="Microsoft.Extensions.DependencyInjection.Abstractions" Version="8.0.1" />
        <PackageReference Include="Microsoft.Extensions.Hosting.Abstractions" Version="8.0.0" />
        <PackageReference Include="Microsoft.Extensions.ObjectPool" Version="8.0.11" />
        <PackageReference Include="Microsoft.AspNetCore.Hosting.Server.Abstractions" Version="2.1.1" />
        <PackageReference Include="System.Text.Json" Version="8.0.6" />
        <PackageReference Include="System.Threading.Channels" Version="8.0.0" />
    </ItemGroup>
    <!-- .NET Standard 2.1 éœ€è¦æ˜¾å¼å¼•ç”¨æ‰€æœ‰ä¾èµ–åŒ…ï¼Œä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆæœ¬ä»¥é¿å…å®‰å…¨æ¼æ´ -->
    <ItemGroup Condition="'$(TargetFramework)' == 'netstandard2.1'">
        <PackageReference Include="Microsoft.AspNetCore.Http.Abstractions" Version="2.3.0" />
        <PackageReference Include="Microsoft.CSharp" Version="4.7.0" />
        <!-- ä½¿ç”¨ 9.0.0 è€Œä¸æ˜¯ 9.0.10ï¼Œå› ä¸ºè¡¥ä¸ç‰ˆæœ¬ä¼šè‡ªåŠ¨è§£æåˆ°æœ€æ–° -->
        <PackageReference Include="Microsoft.Extensions.Logging.Abstractions" Version="9.0.0" />
        <PackageReference Include="Microsoft.Extensions.DependencyInjection" Version="9.0.0" />
        <PackageReference Include="Microsoft.Extensions.DependencyInjection.Abstractions" Version="9.0.0" />
        <PackageReference Include="Microsoft.Extensions.Hosting.Abstractions" Version="9.0.0" />
        <PackageReference Include="Microsoft.Extensions.ObjectPool" Version="9.0.0" />
        <PackageReference Include="Microsoft.AspNetCore.Hosting.Server.Abstractions" Version="2.3.0" />
        <PackageReference Include="System.Text.Json" Version="10.0.2" />
        <PackageReference Include="System.Threading.Channels" Version="10.0.2" />
    </ItemGroup>
    
    <!-- .NET 6.0+ æ¡†æ¶å·²å†…ç½®å¤§éƒ¨åˆ†åŒ…ï¼Œæ— éœ€æ˜¾å¼å¼•ç”¨ï¼Œé™¤ééœ€è¦ç‰¹å®šç‰ˆæœ¬ -->
    <!-- è¿™äº›æ¡†æ¶ç‰ˆæœ¬ä¼šè‡ªåŠ¨ä½¿ç”¨æ¡†æ¶å†…ç½®çš„åŒ…ï¼Œæ›´å®‰å…¨ä¸”æ€§èƒ½æ›´å¥½ -->
    <!-- ä¸º .NET 6.0+ æ˜¾å¼æ·»åŠ  ObjectPool ä»¥ç¡®ä¿å…¼å®¹æ€§ -->
    <ItemGroup Condition="'$(TargetFramework)' == 'net6.0'">
        <PackageReference Include="Microsoft.Extensions.ObjectPool" Version="8.0.11" />
    </ItemGroup>
    <ItemGroup Condition="'$(TargetFramework)' == 'net7.0'">
        <PackageReference Include="Microsoft.Extensions.ObjectPool" Version="8.0.11" />
    </ItemGroup>
    <ItemGroup Condition="'$(TargetFramework)' == 'net8.0'">
        <PackageReference Include="Microsoft.Extensions.ObjectPool" Version="8.0.11" />
    </ItemGroup>
    <ItemGroup Condition="'$(TargetFramework)' == 'net9.0'">
        <PackageReference Include="Microsoft.Extensions.ObjectPool" Version="9.0.0" />
    </ItemGroup>
    <ItemGroup Condition="'$(TargetFramework)' == 'net10.0'">
        <PackageReference Include="Microsoft.Extensions.ObjectPool" Version="10.0.0" />
    </ItemGroup>
    <ItemGroup>
        <None Include="..\..\LICENSE">
            <Pack>True</Pack>
            <PackagePath />
        </None>
        <None Include="..\..\README.md">
            <Pack>True</Pack>
            <PackagePath>\</PackagePath>
        </None>
        <None Include="WebSocketRepository_Logo.png">
            <Pack>True</Pack>
            <PackagePath />
        </None>
    </ItemGroup>
    <!-- Microsoft.Extensions.Configuration.Binder - æ ¹æ®æ¡†æ¶ç‰ˆæœ¬ä½¿ç”¨å¯¹åº”ç‰ˆæœ¬ä»¥ç¡®ä¿å…¼å®¹æ€§å’Œå®‰å…¨æ€§ -->
    <!-- æ³¨æ„ï¼šOpenTelemetry.Exporter.OpenTelemetryProtocol 1.9.0 éœ€è¦ >= 8.0.1ï¼Œå› æ­¤ net6.0 å’Œ net7.0 ä¹Ÿéœ€è¦ä½¿ç”¨è‡³å°‘ 8.0.1 -->
    <ItemGroup Condition="'$(TargetFramework)' == 'netstandard2.1'">
        <PackageReference Include="Microsoft.Extensions.Configuration.Binder" Version="9.0.0" />
    </ItemGroup>
    <!-- .NET 6.0+ æ¡†æ¶å·²å†…ç½®æ­¤åŒ…ï¼Œä½†æ˜¾å¼å¼•ç”¨å¯ä»¥ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ç‰ˆæœ¬ -->
    <!-- ç”±äº OpenTelemetry ä¾èµ–è¦æ±‚ >= 8.0.1ï¼Œnet6.0 å’Œ net7.0 ä¹Ÿéœ€è¦ä½¿ç”¨ 8.0.1 æˆ–æ›´é«˜ç‰ˆæœ¬ -->
    <ItemGroup Condition="'$(TargetFramework)' == 'net6.0'">
        <PackageReference Include="Microsoft.Extensions.Configuration.Binder" Version="8.0.1" />
    </ItemGroup>
    <ItemGroup Condition="'$(TargetFramework)' == 'net7.0'">
        <PackageReference Include="Microsoft.Extensions.Configuration.Binder" Version="8.0.1" />
    </ItemGroup>
    <ItemGroup Condition="'$(TargetFramework)' == 'net8.0'">
        <PackageReference Include="Microsoft.Extensions.Configuration.Binder" Version="8.0.2" />
    </ItemGroup>
    <ItemGroup Condition="'$(TargetFramework)' == 'net9.0'">
        <PackageReference Include="Microsoft.Extensions.Configuration.Binder" Version="9.0.0" />
    </ItemGroup>
    <ItemGroup Condition="'$(TargetFramework)' == 'net10.0'">
        <PackageReference Include="Microsoft.Extensions.Configuration.Binder" Version="10.0.0" />
    </ItemGroup>
    
    <!-- OpenTelemetry Metrics for OTLP export - ä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆæœ¬ï¼Œæ‰€æœ‰æ¡†æ¶ç‰ˆæœ¬ä½¿ç”¨ç›¸åŒç‰ˆæœ¬ -->
    <ItemGroup>
        <PackageReference Include="OpenTelemetry" Version="1.9.0" />
        <PackageReference Include="OpenTelemetry.Extensions.Hosting" Version="1.9.0" />
        <PackageReference Include="OpenTelemetry.Exporter.OpenTelemetryProtocol" Version="1.9.0" />
    </ItemGroup>
</Project>
